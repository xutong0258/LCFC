{"version":3,"file":"request-DqZZIVBd.js","sources":["../../src/utils/request.ts"],"sourcesContent":["import axios from 'axios'\nimport type { AxiosInstance, InternalAxiosRequestConfig, AxiosResponse } from 'axios'\nimport { ElMessage } from 'element-plus'\n\n// 创建axios实例\nconst service: AxiosInstance = axios.create({\n  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',\n  timeout: 10000\n})\n\n// 请求拦截器\nservice.interceptors.request.use(\n  (config: InternalAxiosRequestConfig) => {\n    // 在发送请求之前做些什么\n    // 例如添加token\n    const token = localStorage.getItem('token') || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiMSIsInVzZXJfbmFtZSI6ImFkbWluIiwiZGVwdF9uYW1lIjoiXHU3ODE0XHU1M2QxXHU5MGU4XHU5NWU4Iiwic2Vzc2lvbl9pZCI6Ijc5ODFiMDdmLTAzZjMtNGY1MC04ODA4LWNlYTVlNmRlOGUzNiIsImxvZ2luX2luZm8iOm51bGwsImV4cCI6MjAxOTczNzU3N30.Gc3JPHkw3MmLvqd6meRRusCoN7l_l-dOnB5djNE3EG0'\n    if (token) {\n      config.headers = config.headers || {}\n      config.headers.Authorization = `Bearer ${token}`\n    }\n    return config\n  },\n  (error) => {\n    // 对请求错误做些什么\n    console.error('Request error:', error)\n    return Promise.reject(error)\n  }\n)\n\n// 响应拦截器\nservice.interceptors.response.use(\n  (response: AxiosResponse) => {\n    // 对响应数据做点什么\n    const { code, message, data } = response.data\n\n    if (code === 200) {\n      return response.data\n    } else {\n      ElMessage.error(message || '请求失败')\n      return Promise.reject(new Error(message || '请求失败'))\n    }\n  },\n  (error) => {\n    // 对响应错误做点什么\n    console.error('Response error:', error)\n\n    if (error.response?.status === 401) {\n      // 处理未授权\n      ElMessage.error('登录已过期，请重新登录')\n      // 可以在这里处理登出逻辑\n    } else {\n      ElMessage.error(error.message || '网络错误')\n    }\n\n    return Promise.reject(error)\n  }\n)\n\nexport default service\n\n\nfunction instancePromise<R = any, T = any>(options: AxiosOptions<T> & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const {loading} = options\n    return new Promise((resolve, reject) => {\n        service.request(options).then((res: any) => {\n            resolve(res as any)\n        }).catch((e: Error | AxiosError) => {\n            reject(e)\n        })\n            .finally(() => {\n                if (loading)\n                    axiosLoading.closeLoading()\n            })\n    })\n}\n\nexport function useGet<R = any, T = any>(url: string, params?: T, config?: AxiosRequestConfig & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const options = {\n        url,\n        params,\n        method: \"GET\",\n        ...config,\n    }\n    return instancePromise<R, T>(options)\n}\n\nexport function useGetBlob<R = any, T = any>(url: string, params?: T, config?: AxiosRequestConfig & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const options = {\n        url,\n        params,\n        responseType: 'blob',\n        method: \"GET\",\n        ...config,\n    }\n    return instancePromise<R, T>(options)\n}\n\nexport function usePost<R = any, T = any>(url: string, data?: T, config?: AxiosRequestConfig & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const options = {\n        url,\n        data,\n        method: \"POST\",\n        ...config,\n    }\n    return instancePromise<R, T>(options)\n}\n\nexport function usePut<R = any, T = any>(url: string, data?: T, config?: AxiosRequestConfig & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const options = {\n        url,\n        data,\n        method: \"PUT\",\n        ...config,\n    }\n    return instancePromise<R, T>(options)\n}\n\nexport function useDelete<R = any, T = any>(url: string, data?: T, config?: AxiosRequestConfig & RequestConfigExtra): Promise<ResponseBody<R>> {\n    const options = {\n        url,\n        data,\n        method: \"DELETE\",\n        ...config,\n    }\n    return instancePromise<R, T>(options)\n}\n"],"names":["service","axios","config","token","error","response","code","message","data","ElMessage","instancePromise","options","loading","resolve","reject","res","e","useGet","url","params","usePost"],"mappings":"uFAKA,MAAMA,EAAyBC,EAAM,OAAO,CAC1C,QAAS,0BACT,QAAS,GACX,CAAC,EAGDD,EAAQ,aAAa,QAAQ,IAC1BE,GAAuC,CAGtC,MAAMC,EAAQ,aAAa,QAAQ,OAAO,GAAK,2SAE7C,OAAAD,EAAO,QAAUA,EAAO,SAAW,CAAA,EACnCA,EAAO,QAAQ,cAAgB,UAAUC,CAAK,GAEzCD,CACT,EACCE,IAEC,QAAQ,MAAM,iBAAkBA,CAAK,EAC9B,QAAQ,OAAOA,CAAK,EAE/B,EAGAJ,EAAQ,aAAa,SAAS,IAC3BK,GAA4B,CAE3B,KAAM,CAAE,KAAAC,EAAM,QAAAC,EAAS,KAAAC,CAAA,EAASH,EAAS,KAEzC,OAAIC,IAAS,IACJD,EAAS,MAEhBI,EAAU,MAAMF,GAAW,MAAM,EAC1B,QAAQ,OAAO,IAAI,MAAMA,GAAW,MAAM,CAAC,EAEtD,EACCH,IAEC,QAAQ,MAAM,kBAAmBA,CAAK,EAElCA,EAAM,UAAU,SAAW,IAE7BK,EAAU,MAAM,aAAa,EAG7BA,EAAU,MAAML,EAAM,SAAW,MAAM,EAGlC,QAAQ,OAAOA,CAAK,EAE/B,EAKA,SAASM,EAAkCC,EAAyE,CAChH,KAAM,CAAC,QAAAC,GAAWD,EAClB,OAAO,IAAI,QAAQ,CAACE,EAASC,IAAW,CACpCd,EAAQ,QAAQW,CAAO,EAAE,KAAMI,GAAa,CACxCF,EAAQE,CAAU,CACtB,CAAC,EAAE,MAAOC,GAA0B,CAChCF,EAAOE,CAAC,CACZ,CAAC,EACI,QAAQ,IAAM,CACPJ,GACA,aAAa,aAAA,CACrB,CAAC,CACT,CAAC,CACL,CAEO,SAASK,EAAyBC,EAAaC,EAAYjB,EAA4E,CAC1I,MAAMS,EAAU,CACZ,IAAAO,EACA,OAAAC,EACA,OAAQ,MACR,GAAGjB,CAAA,EAEP,OAAOQ,EAAsBC,CAAO,CACxC,CAaO,SAASS,EAA0BF,EAAaV,EAAUN,EAA4E,CACzI,MAAMS,EAAU,CACZ,IAAAO,EACA,KAAAV,EACA,OAAQ,OACR,GAAGN,CAAA,EAEP,OAAOQ,EAAsBC,CAAO,CACxC"}