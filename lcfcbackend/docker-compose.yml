version: "3.8"

services:
  lcfcbackend:
    build: .
    container_name: lcfcbackend
    ports:
      - "8080:8080"
    volumes:
      # 持久化上传文件目录
      - ./vf_admin/upload_path:/app/vf_admin/upload_path
      - ./vf_admin/download_path:/app/vf_admin/download_path
      # 持久化日志目录
      - ./logs:/app/logs
      # 挂载环境配置文件
      - ./.env.dev:/app/.env.dev:ro
    environment:
      - APP_ENV=dev
    restart: unless-stopped
    healthcheck:
      test:
        [
          "CMD",
          "python",
          "-c",
          "import requests; requests.get('http://localhost:8080/api/docs', timeout=10)",
        ]
      interval: 30s
      timeout: 30s
      retries: 3
      start_period: 40s
    # 资源限制
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: "3.0"
        reservations:
          memory: 2G
          cpus: "2.0"
    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
